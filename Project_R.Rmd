Project

packages
```{r}
# install.packages("rvest")
library(rvest)
```

```{r}
# 1. Extract the full name of ISO Country code from https://help.adjust.com/en/article/countriesby-region 

# Read the HTML page
page <- read_html("https://help.adjust.com/en/article/countries-by-region")

# Extract the first table
country_table <- data.frame(html_table(html_element(page, "table"),na = character(0)))

# Change all country codes to uppercase to match music_table
country_table$Country.code <- toupper(country_table$Country.code)

# Add the full name of the region
regionName <- c("EMEA" = "Europe, the Middle East and Africa",
                "NA" = "North America",
                "LATAM" = "Latin America",
                "APAC" = "Asia-Pacific")

country_table$Region_name <- regionName[country_table$Region]
head(country_table)
```
```{r}
# 2. convert the country to the fill name
# Load dataset
music_data <- read.csv("top_Trending_songs.csv")

# Change the country of the first fifty records to ‘Global’
music_data$country[1:50] <- "Global"

# Change the two date-related columns to date format
music_data$snapshot_date <- as.Date(music_data$snapshot_date)
music_data$album_release_date <- as.Date(music_data$album_release_date)
head(music_data)

```
```{r}
#Update
music_data$country <- country_table$Country[match(music_data$country, country_table$Country.code)]

#This method can directly match the rules and change the content without merging the dataframe and disrupting the order of the columns.

#then no need next chunk
```

```{r}
# Merge on the country code
music_data <- merge(music_data,
                    country_table,
                    by.x = "country",
                    by.y = "Country.code",
                    all.x = TRUE)


# Reorder columns
music_data <- music_data[, c("country",
                             "spotify_id", "name", "artists", "daily_rank",
                             "daily_movement", "weekly_movement", "snapshot_date",
                             "popularity", "is_explicit", "duration_ms", "album_name",
                             "album_release_date", "danceability", "energy", "key",
                             "loudness", "mode", "speechiness", "acousticness",
                             "instrumentalness", "liveness", "valence", "tempo",
                             "time_signature")]


```


```{r}
# Save the merged dataset
write.csv(music_data, "Music_With_Country.csv", row.names = FALSE)

mergeM <- read.csv("Music_With_Country.csv")
head(mergeM)
```


